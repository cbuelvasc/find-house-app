"use strict";var __decorate=this&&this.__decorate||function(e,s,t,r){var i,o=arguments.length,a=o<3?s:null===r?r=Object.getOwnPropertyDescriptor(s,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,s,t,r);else for(var u=e.length-1;0<=u;u--)(i=e[u])&&(a=(o<3?i(a):3<o?i(s,t,a):i(s,t))||a);return 3<o&&a&&Object.defineProperty(s,t,a),a};exports.__esModule=!0;var core_1=require("@angular/core"),forms_1=require("@angular/forms"),rxjs_1=require("rxjs"),store_1=require("@ngrx/store"),crud_1=require("../../../../../core/_base/crud"),auth_1=require("../../../../../core/auth"),UserEditComponent=function(){function e(e,s,t,r,i,o,a){this.activatedRoute=e,this.router=s,this.userFB=t,this.subheaderService=r,this.layoutUtilsService=i,this.store=o,this.layoutConfigService=a,this.selectedTab=0,this.rolesSubject=new rxjs_1.BehaviorSubject([]),this.addressSubject=new rxjs_1.BehaviorSubject(new auth_1.Address),this.soicialNetworksSubject=new rxjs_1.BehaviorSubject(new auth_1.SocialNetworks),this.hasFormErrors=!1,this.subscriptions=[]}return e.prototype.ngOnInit=function(){var t=this;this.loading$=this.store.pipe(store_1.select(auth_1.selectUsersActionLoading));var e=this.activatedRoute.params.subscribe(function(e){var s=e.id;s?t.store.pipe(store_1.select(auth_1.selectUserById(s))).subscribe(function(e){e&&(t.user=e,t.rolesSubject.next(t.user.roles),t.addressSubject.next(t.user.address),t.soicialNetworksSubject.next(t.user.socialNetworks),t.oldUser=Object.assign({},t.user),t.initUser())}):(t.user=new auth_1.User,t.user.clear(),t.rolesSubject.next(t.user.roles),t.addressSubject.next(t.user.address),t.soicialNetworksSubject.next(t.user.socialNetworks),t.oldUser=Object.assign({},t.user),t.initUser())});this.subscriptions.push(e)},e.prototype.ngOnDestroy=function(){this.subscriptions.forEach(function(e){return e.unsubscribe()})},e.prototype.initUser=function(){if(this.createForm(),console.log(this.user.id),!this.user.id)return this.subheaderService.setTitle("Create user"),void this.subheaderService.setBreadcrumbs([{title:"User Management",page:"user-management"},{title:"Users",page:"user-management/users"},{title:"Create user",page:"user-management/users/add"}]);this.subheaderService.setTitle("Edit user"),this.subheaderService.setBreadcrumbs([{title:"User Management",page:"user-management"},{title:"Users",page:"user-management/users"},{title:"Edit user",page:"user-management/users/edit",queryParams:{id:this.user.id}}])},e.prototype.createForm=function(){this.userForm=this.userFB.group({username:[this.user.username,forms_1.Validators.required],fullname:[this.user.fullname,forms_1.Validators.required],email:[this.user.email,forms_1.Validators.email],phone:[this.user.phone],companyName:[this.user.companyName],occupation:[this.user.occupation]})},e.prototype.goBackWithId=function(){this.router.navigateByUrl("/user-management/users",{relativeTo:this.activatedRoute})},e.prototype.refreshUser=function(e,s){void 0===e&&(e=!1),void 0===s&&(s="");var t=this.router.url;e?(t="/user-management/users/edit/"+s,this.router.navigateByUrl(t,{relativeTo:this.activatedRoute})):this.router.navigate([t],{relativeTo:this.activatedRoute})},e.prototype.reset=function(){this.user=Object.assign({},this.oldUser),this.createForm(),this.hasFormErrors=!1,this.userForm.markAsPristine(),this.userForm.markAsUntouched(),this.userForm.updateValueAndValidity()},e.prototype.onSumbit=function(e){void 0===e&&(e=!1),this.hasFormErrors=!1;var s=this.userForm.controls;if(this.userForm.invalid)return Object.keys(s).forEach(function(e){return s[e].markAsTouched()}),this.hasFormErrors=!0,void(this.selectedTab=0);var t=this.prepareUser();t.id?this.updateUser(t,e):this.addUser(t,e)},e.prototype.prepareUser=function(){var e=this.userForm.controls,s=new auth_1.User;return s.clear(),s.roles=this.rolesSubject.value,s.address=this.addressSubject.value,s.socialNetworks=this.soicialNetworksSubject.value,s.accessToken=this.user.accessToken,s.refreshToken=this.user.refreshToken,s.pic=this.user.pic,s.id=this.user.id,s.username=e.username.value,s.email=e.email.value,s.fullname=e.fullname.value,s.occupation=e.occupation.value,s.phone=e.phone.value,s.companyName=e.companyName.value,s.password=this.user.password,s},e.prototype.addUser=function(e,s){var t=this;void 0===s&&(s=!1),this.store.dispatch(new auth_1.UserOnServerCreated({user:e}));var r=this.store.pipe(store_1.select(auth_1.selectLastCreatedUserId)).subscribe(function(e){t.layoutUtilsService.showActionNotification("New user successfully has been added.",crud_1.MessageType.Create,5e3,!0,!0),e&&(s?t.goBackWithId():t.refreshUser(!0,e))});this.subscriptions.push(r)},e.prototype.updateUser=function(e,s){void 0===s&&(s=!1);var t={id:e.id,changes:e};this.store.dispatch(new auth_1.UserUpdated({partialUser:t,user:e}));this.layoutUtilsService.showActionNotification("User successfully has been saved.",crud_1.MessageType.Update,5e3,!0,!0),s?this.goBackWithId():this.refreshUser(!1)},e.prototype.getComponentTitle=function(){var e="Create user";return this.user&&this.user.id?e="Edit user - "+this.user.fullname:e},e.prototype.onAlertClose=function(e){this.hasFormErrors=!1},e=__decorate([core_1.Component({selector:"kt-user-edit",templateUrl:"./user-edit.component.html"})],e)}();exports.UserEditComponent=UserEditComponent;
//# sourceMappingURL=user-edit.component.min.js.map
