{"version":3,"sources":["user-edit.component.ts"],"names":[],"mappings":"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","file":"user-edit.component.js","sourcesContent":["// Angular\r\nimport { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\n// RxJS\r\nimport { BehaviorSubject, Observable, of, Subscription } from 'rxjs';\r\n// NGRX\r\nimport { Store, select } from '@ngrx/store';\r\nimport { Update } from '@ngrx/entity';\r\nimport { AppState } from '../../../../../core/reducers';\r\n// Layout\r\nimport { SubheaderService, LayoutConfigService } from '../../../../../core/_base/layout';\r\nimport { LayoutUtilsService, MessageType } from '../../../../../core/_base/crud';\r\n// Services and Models\r\nimport {\r\n\tUser,\r\n\tUserUpdated,\r\n\tAddress,\r\n\tSocialNetworks,\r\n\tselectHasUsersInStore,\r\n\tselectUserById,\r\n\tUserOnServerCreated,\r\n\tselectLastCreatedUserId,\r\n\tselectUsersActionLoading\r\n} from '../../../../../core/auth';\r\n\r\n@Component({\r\n\tselector: 'kt-user-edit',\r\n\ttemplateUrl: './user-edit.component.html',\r\n})\r\nexport class UserEditComponent implements OnInit, OnDestroy {\r\n\t// Public properties\r\n\tuser: User;\r\n\tuserId$: Observable<string>;\r\n\toldUser: User;\r\n\tselectedTab = 0;\r\n\tloading$: Observable<boolean>;\r\n\trolesSubject = new BehaviorSubject<string[]>([]);\r\n\taddressSubject = new BehaviorSubject<Address>(new Address());\r\n\tsoicialNetworksSubject = new BehaviorSubject<SocialNetworks>(new SocialNetworks());\r\n\tuserForm: FormGroup;\r\n\thasFormErrors = false;\r\n\t// Private properties\r\n\tprivate subscriptions: Subscription[] = [];\r\n\r\n\tconstructor(private activatedRoute: ActivatedRoute,\r\n\t\tprivate router: Router,\r\n\t\tprivate userFB: FormBuilder,\r\n\t\tprivate subheaderService: SubheaderService,\r\n\t\tprivate layoutUtilsService: LayoutUtilsService,\r\n\t\tprivate store: Store<AppState>,\r\n\t\tprivate layoutConfigService: LayoutConfigService) { }\r\n\r\n\t/**\r\n\t * @ Lifecycle sequences => https://angular.io/guide/lifecycle-hooks\r\n\t */\r\n\r\n\t/**\r\n\t * On init\r\n\t */\r\n\tngOnInit() {\r\n\t\tthis.loading$ = this.store.pipe(select(selectUsersActionLoading));\r\n\r\n\t\tconst routeSubscription = this.activatedRoute.params.subscribe(params => {\r\n\t\t\tconst id = params.id;\r\n\t\t\tif (id) {\r\n\t\t\t\tthis.store.pipe(select(selectUserById(id))).subscribe(res => {\r\n\t\t\t\t\tif (res) {\r\n\t\t\t\t\t\tthis.user = res;\r\n\t\t\t\t\t\tthis.rolesSubject.next(this.user.roles);\r\n\t\t\t\t\t\tthis.addressSubject.next(this.user.address);\r\n\t\t\t\t\t\tthis.soicialNetworksSubject.next(this.user.socialNetworks);\r\n\t\t\t\t\t\tthis.oldUser = Object.assign({}, this.user);\r\n\t\t\t\t\t\tthis.initUser();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tthis.user = new User();\r\n\t\t\t\tthis.user.clear();\r\n\t\t\t\tthis.rolesSubject.next(this.user.roles);\r\n\t\t\t\tthis.addressSubject.next(this.user.address);\r\n\t\t\t\tthis.soicialNetworksSubject.next(this.user.socialNetworks);\r\n\t\t\t\tthis.oldUser = Object.assign({}, this.user);\r\n\t\t\t\tthis.initUser();\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.subscriptions.push(routeSubscription);\r\n\t}\r\n\r\n\tngOnDestroy() {\r\n\t\tthis.subscriptions.forEach(sb => sb.unsubscribe());\r\n\t}\r\n\r\n\t/**\r\n\t * Init user\r\n\t */\r\n\tinitUser() {\r\n\t\tthis.createForm();\r\n\t\tconsole.log(this.user.id);\r\n\t\tif (!this.user.id) {\r\n\t\t\tthis.subheaderService.setTitle('Create user');\r\n\t\t\tthis.subheaderService.setBreadcrumbs([\r\n\t\t\t\t{ title: 'User Management', page: `user-management` },\r\n\t\t\t\t{ title: 'Users', page: `user-management/users` },\r\n\t\t\t\t{ title: 'Create user', page: `user-management/users/add` }\r\n\t\t\t]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.subheaderService.setTitle('Edit user');\r\n\t\tthis.subheaderService.setBreadcrumbs([\r\n\t\t\t{ title: 'User Management', page: `user-management` },\r\n\t\t\t{ title: 'Users', page: `user-management/users` },\r\n\t\t\t{ title: 'Edit user', page: `user-management/users/edit`, queryParams: { id: this.user.id } }\r\n\t\t]);\r\n\t}\r\n\r\n\t/**\r\n\t * Create form\r\n\t */\r\n\tcreateForm() {\r\n\t\tthis.userForm = this.userFB.group({\r\n\t\t\tusername: [this.user.username, Validators.required],\r\n\t\t\tfullname: [this.user.fullname, Validators.required],\r\n\t\t\temail: [this.user.email, Validators.email],\r\n\t\t\tphone: [this.user.phone],\r\n\t\t\tcompanyName: [this.user.companyName],\r\n\t\t\toccupation: [this.user.occupation]\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Redirect to list\r\n\t *\r\n\t */\r\n\tgoBackWithId() {\r\n\t\tconst url = `/user-management/users`;\r\n\t\tthis.router.navigateByUrl(url, { relativeTo: this.activatedRoute });\r\n\t}\r\n\r\n\t/**\r\n\t * Refresh user\r\n\t *\r\n\t * @param isNew: boolean\r\n\t * @param id: number\r\n\t */\r\n\trefreshUser(isNew: boolean = false, id: string = '') {\r\n\t\tlet url = this.router.url;\r\n\t\tif (!isNew) {\r\n\t\t\tthis.router.navigate([url], { relativeTo: this.activatedRoute });\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\turl = `/user-management/users/edit/${id}`;\r\n\t\tthis.router.navigateByUrl(url, { relativeTo: this.activatedRoute });\r\n\t}\r\n\r\n\t/**\r\n\t * Reset\r\n\t */\r\n\treset() {\r\n\t\tthis.user = Object.assign({}, this.oldUser);\r\n\t\tthis.createForm();\r\n\t\tthis.hasFormErrors = false;\r\n\t\tthis.userForm.markAsPristine();\r\n\t\tthis.userForm.markAsUntouched();\r\n\t\tthis.userForm.updateValueAndValidity();\r\n\t}\r\n\r\n\t/**\r\n\t * Save data\r\n\t *\r\n\t * @param withBack: boolean\r\n\t */\r\n\tonSumbit(withBack: boolean = false) {\r\n\t\tthis.hasFormErrors = false;\r\n\t\tconst controls = this.userForm.controls;\r\n\t\t/** check form */\r\n\t\tif (this.userForm.invalid) {\r\n\t\t\tObject.keys(controls).forEach(controlName =>\r\n\t\t\t\tcontrols[controlName].markAsTouched()\r\n\t\t\t);\r\n\r\n\t\t\tthis.hasFormErrors = true;\r\n\t\t\tthis.selectedTab = 0;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst editedUser = this.prepareUser();\r\n\r\n\t\tif (editedUser.id) {\r\n\t\t\tthis.updateUser(editedUser, withBack);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.addUser(editedUser, withBack);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns prepared data for save\r\n\t */\r\n\tprepareUser(): User {\r\n\t\tconst controls = this.userForm.controls;\r\n\t\tconst _user = new User();\r\n\t\t_user.clear();\r\n\t\t_user.roles = this.rolesSubject.value;\r\n\t\t_user.address = this.addressSubject.value;\r\n\t\t_user.socialNetworks = this.soicialNetworksSubject.value;\r\n\t\t_user.accessToken = this.user.accessToken;\r\n\t\t_user.refreshToken = this.user.refreshToken;\r\n\t\t_user.pic = this.user.pic;\r\n\t\t_user.id = this.user.id;\r\n\t\t_user.username = controls.username.value;\r\n\t\t_user.email = controls.email.value;\r\n\t\t_user.fullname = controls.fullname.value;\r\n\t\t_user.occupation = controls.occupation.value;\r\n\t\t_user.phone = controls.phone.value;\r\n\t\t_user.companyName = controls.companyName.value;\r\n\t\t_user.password = this.user.password;\r\n\t\treturn _user;\r\n\t}\r\n\r\n\t/**\r\n\t * Add User\r\n\t *\r\n\t * @param _user: User\r\n\t * @param withBack: boolean\r\n\t */\r\n\taddUser(_user: User, withBack: boolean = false) {\r\n\t\tthis.store.dispatch(new UserOnServerCreated({ user: _user }));\r\n\t\tconst addSubscription = this.store.pipe(select(selectLastCreatedUserId)).subscribe(newId => {\r\n\t\t\tconst message = `New user successfully has been added.`;\r\n\t\t\tthis.layoutUtilsService.showActionNotification(message, MessageType.Create, 5000, true, true);\r\n\t\t\tif (newId) {\r\n\t\t\t\tif (withBack) {\r\n\t\t\t\t\tthis.goBackWithId();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.refreshUser(true, newId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.subscriptions.push(addSubscription);\r\n\t}\r\n\r\n\t/**\r\n\t * Update user\r\n\t *\r\n\t * @param _user: User\r\n\t * @param withBack: boolean\r\n\t */\r\n\tupdateUser(_user: User, withBack: boolean = false) {\r\n\t\t// Update User\r\n\t\t// tslint:disable-next-line:prefer-const\r\n\r\n\t\tconst updatedUser: Update<User> = {\r\n\t\t\tid: _user.id,\r\n\t\t\tchanges: _user\r\n\t\t};\r\n\t\tthis.store.dispatch(new UserUpdated({ partialUser: updatedUser, user: _user }));\r\n\t\tconst message = `User successfully has been saved.`;\r\n\t\tthis.layoutUtilsService.showActionNotification(message, MessageType.Update, 5000, true, true);\r\n\t\tif (withBack) {\r\n\t\t\tthis.goBackWithId();\r\n\t\t} else {\r\n\t\t\tthis.refreshUser(false);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns component title\r\n\t */\r\n\tgetComponentTitle() {\r\n\t\tlet result = 'Create user';\r\n\t\tif (!this.user || !this.user.id) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = `Edit user - ${this.user.fullname}`;\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Close Alert\r\n\t *\r\n\t * @param $event: Event\r\n\t */\r\n\tonAlertClose($event) {\r\n\t\tthis.hasFormErrors = false;\r\n\t}\r\n}\r\n"]}