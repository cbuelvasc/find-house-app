{"version":3,"sources":["products-list.component.ts"],"names":[],"mappings":"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","file":"products-list.component.js","sourcesContent":["// Angular\r\nimport { Component, OnInit, ElementRef, ViewChild, ChangeDetectionStrategy, OnDestroy } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\n// Material\r\nimport { MatPaginator } from '@angular/material/paginator';\r\nimport { MatSort } from '@angular/material/sort';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { SelectionModel } from '@angular/cdk/collections';\r\n// RXJS\r\nimport { debounceTime, distinctUntilChanged, tap, skip, delay } from 'rxjs/operators';\r\nimport { fromEvent, merge, Observable, of, Subscription } from 'rxjs';\r\n// NGRX\r\nimport { Store, select } from '@ngrx/store';\r\nimport { AppState } from '../../../../../../core/reducers';\r\n// UI\r\nimport { SubheaderService } from '../../../../../../core/_base/layout';\r\n// CRUD\r\nimport { LayoutUtilsService, MessageType, QueryParamsModel } from '../../../../../../core/_base/crud';\r\n// Services and Models\r\nimport {\r\n\tProductModel,\r\n\tProductsDataSource,\r\n\tProductsPageRequested,\r\n\tOneProductDeleted,\r\n\tManyProductsDeleted,\r\n\tProductsStatusUpdated,\r\n\tselectProductsPageLastQuery\r\n} from '../../../../../../core/e-commerce';\r\n\r\n// Table with EDIT item in new page\r\n// ARTICLE for table with sort/filter/paginator\r\n// https://blog.angular-university.io/angular-material-data-table/\r\n// https://v5.material.angular.io/components/table/overview\r\n// https://v5.material.angular.io/components/sort/overview\r\n// https://v5.material.angular.io/components/table/overview#sorting\r\n// https://www.youtube.com/watch?v=NSt9CI3BXv4\r\n@Component({\r\n\t// tslint:disable-next-line:component-selector\r\n\tselector: 'kt-products-list',\r\n\ttemplateUrl: './products-list.component.html',\r\n\tchangeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ProductsListComponent implements OnInit, OnDestroy {\r\n\t// Table fields\r\n\tdataSource: ProductsDataSource;\r\n\tdisplayedColumns = ['select', 'VINCode', 'manufacture', 'model', 'modelYear', 'color', 'price', 'condition', 'status', 'actions'];\r\n\t@ViewChild(MatPaginator, { static: true }) paginator: MatPaginator;\r\n\t@ViewChild('sort1', { static: true }) sort: MatSort;\r\n\t// Filter fields\r\n\t@ViewChild('searchInput', { static: true }) searchInput: ElementRef;\r\n\tfilterStatus = '';\r\n\tfilterCondition = '';\r\n\tlastQuery: QueryParamsModel;\r\n\t// Selection\r\n\tselection = new SelectionModel<ProductModel>(true, []);\r\n\tproductsResult: ProductModel[] = [];\r\n\tprivate subscriptions: Subscription[] = [];\r\n\r\n\t/**\r\n\t * Component constructor\r\n\t *\r\n\t * @param dialog: MatDialog\r\n\t * @param activatedRoute: ActivatedRoute\r\n\t * @param router: Router\r\n\t * @param subheaderService: SubheaderService\r\n\t * @param layoutUtilsService: LayoutUtilsService\r\n\t * @param store: Store<AppState>\r\n\t */\r\n\tconstructor(public dialog: MatDialog,\r\n\t\tprivate activatedRoute: ActivatedRoute,\r\n\t\tprivate router: Router,\r\n\t\tprivate subheaderService: SubheaderService,\r\n\t\tprivate layoutUtilsService: LayoutUtilsService,\r\n\t\tprivate store: Store<AppState>) { }\r\n\r\n\t/**\r\n\t * @ Lifecycle sequences => https://angular.io/guide/lifecycle-hooks\r\n\t */\r\n\r\n\t/**\r\n\t * On init\r\n\t */\r\n\tngOnInit() {\r\n\t\t// If the user changes the sort order, reset back to the first page.\r\n\t\tconst sortSubscription = this.sort.sortChange.subscribe(() => (this.paginator.pageIndex = 0));\r\n\t\tthis.subscriptions.push(sortSubscription);\r\n\r\n\t\t/* Data load will be triggered in two cases:\r\n\t\t- when a pagination event occurs => this.paginator.page\r\n\t\t- when a sort event occurs => this.sort.sortChange\r\n\t\t**/\r\n\t\tconst paginatorSubscriptions = merge(this.sort.sortChange, this.paginator.page).pipe(\r\n\t\t\ttap(() => this.loadProductsList())\r\n\t\t)\r\n\t\t\t.subscribe();\r\n\t\tthis.subscriptions.push(paginatorSubscriptions);\r\n\r\n\t\t// Filtration, bind to searchInput\r\n\t\tconst searchSubscription = fromEvent(this.searchInput.nativeElement, 'keyup').pipe(\r\n\t\t\tdebounceTime(150),\r\n\t\t\tdistinctUntilChanged(),\r\n\t\t\ttap(() => {\r\n\t\t\t\tthis.paginator.pageIndex = 0;\r\n\t\t\t\tthis.loadProductsList();\r\n\t\t\t})\r\n\t\t)\r\n\t\t\t.subscribe();\r\n\t\tthis.subscriptions.push(searchSubscription);\r\n\r\n\t\t// Set title to page breadCrumbs\r\n\t\tthis.subheaderService.setTitle('Products');\r\n\r\n\t\t// Init DataSource\r\n\t\tthis.dataSource = new ProductsDataSource(this.store);\r\n\t\tconst entitiesSubscription = this.dataSource.entitySubject.pipe(\r\n\t\t\tskip(1),\r\n\t\t\tdistinctUntilChanged()\r\n\t\t).subscribe(res => {\r\n\t\t\tthis.productsResult = res;\r\n\t\t});\r\n\t\tthis.subscriptions.push(entitiesSubscription);\r\n\t\tconst lastQuerySubscription = this.store.pipe(select(selectProductsPageLastQuery)).subscribe(res => this.lastQuery = res);\r\n\t\t// Load last query from store\r\n\t\tthis.subscriptions.push(lastQuerySubscription);\r\n\r\n\t\t// Read from URL itemId, for restore previous state\r\n\t\tconst routeSubscription = this.activatedRoute.queryParams.subscribe(params => {\r\n\t\t\tif (params.id) {\r\n\t\t\t\tthis.restoreState(this.lastQuery, +params.id);\r\n\t\t\t}\r\n\r\n\t\t\t// First load\r\n\t\t\tof(undefined).pipe(delay(1000)).subscribe(() => { // Remove this line, just loading imitation\r\n\t\t\t\tthis.loadProductsList();\r\n\t\t\t}); // Remove this line, just loading imitation\r\n\t\t});\r\n\t\tthis.subscriptions.push(routeSubscription);\r\n\t}\r\n\r\n\t/**\r\n\t * On Destroy\r\n\t */\r\n\tngOnDestroy() {\r\n\t\tthis.subscriptions.forEach(el => el.unsubscribe());\r\n\t}\r\n\r\n\t/**\r\n\t * Load Products List\r\n\t */\r\n\tloadProductsList() {\r\n\t\tthis.selection.clear();\r\n\t\tconst queryParams = new QueryParamsModel(\r\n\t\t\tthis.filterConfiguration(),\r\n\t\t\tthis.sort.direction,\r\n\t\t\tthis.sort.active,\r\n\t\t\tthis.paginator.pageIndex,\r\n\t\t\tthis.paginator.pageSize\r\n\t\t);\r\n\t\t// Call request from server\r\n\t\tthis.store.dispatch(new ProductsPageRequested({ page: queryParams }));\r\n\t\tthis.selection.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns object for filter\r\n\t */\r\n\tfilterConfiguration(): any {\r\n\t\tconst filter: any = {};\r\n\t\tconst searchText: string = this.searchInput.nativeElement.value;\r\n\r\n\t\tif (this.filterStatus && this.filterStatus.length > 0) {\r\n\t\t\tfilter.status = +this.filterStatus;\r\n\t\t}\r\n\r\n\t\tif (this.filterCondition && this.filterCondition.length > 0) {\r\n\t\t\tfilter.condition = +this.filterCondition;\r\n\t\t}\r\n\r\n\t\tfilter.model = searchText;\r\n\r\n\t\tfilter.manufacture = searchText;\r\n\t\tfilter.color = searchText;\r\n\t\tfilter.VINCode = searchText;\r\n\t\treturn filter;\r\n\t}\r\n\r\n\t/**\r\n\t * Restore state\r\n\t *\r\n\t * @param queryParams: QueryParamsModel\r\n\t * @param id: number\r\n\t */\r\n\trestoreState(queryParams: QueryParamsModel, id: number) {\r\n\r\n\t\tif (!queryParams.filter) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ('condition' in queryParams.filter) {\r\n\t\t\tthis.filterCondition = queryParams.filter.condition.toString();\r\n\t\t}\r\n\r\n\t\tif ('status' in queryParams.filter) {\r\n\t\t\tthis.filterStatus = queryParams.filter.status.toString();\r\n\t\t}\r\n\r\n\t\tif (queryParams.filter.model) {\r\n\t\t\tthis.searchInput.nativeElement.value = queryParams.filter.model;\r\n\t\t}\r\n\t}\r\n\r\n\t/** ACTIONS */\r\n\t/**\r\n\t * Delete product\r\n\t *\r\n\t * @param _item: ProductModel\r\n\t */\r\n\tdeleteProduct(_item: ProductModel) {\r\n\t\tconst _title = 'Product Delete';\r\n\t\tconst _description = 'Are you sure to permanently delete this product?';\r\n\t\tconst _waitDesciption = 'Product is deleting...';\r\n\t\tconst _deleteMessage = `Product has been deleted`;\r\n\r\n\t\tconst dialogRef = this.layoutUtilsService.deleteElement(_title, _description, _waitDesciption);\r\n\t\tdialogRef.afterClosed().subscribe(res => {\r\n\t\t\tif (!res) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.store.dispatch(new OneProductDeleted({ id: _item.id }));\r\n\t\t\tthis.layoutUtilsService.showActionNotification(_deleteMessage, MessageType.Delete);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Delete products\r\n\t */\r\n\tdeleteProducts() {\r\n\t\tconst _title = 'Products Delete';\r\n\t\tconst _description = 'Are you sure to permanently delete selected products?';\r\n\t\tconst _waitDesciption = 'Products are deleting...';\r\n\t\tconst _deleteMessage = 'Selected products have been deleted';\r\n\r\n\t\tconst dialogRef = this.layoutUtilsService.deleteElement(_title, _description, _waitDesciption);\r\n\t\tdialogRef.afterClosed().subscribe(res => {\r\n\t\t\tif (!res) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst idsForDeletion: string[] = [];\r\n\t\t\t// tslint:disable-next-line:prefer-for-of\r\n\t\t\tfor (let i = 0; i < this.selection.selected.length; i++) {\r\n\t\t\t\tidsForDeletion.push(this.selection.selected[i].id);\r\n\t\t\t}\r\n\t\t\tthis.store.dispatch(new ManyProductsDeleted({ ids: idsForDeletion }));\r\n\t\t\tthis.layoutUtilsService.showActionNotification(_deleteMessage, MessageType.Delete);\r\n\t\t\tthis.selection.clear();\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Fetch selected products\r\n\t */\r\n\tfetchProducts() {\r\n\t\t// tslint:disable-next-line:prefer-const\r\n\t\tlet messages = [];\r\n\t\tthis.selection.selected.forEach(elem => {\r\n\t\t\tmessages.push({\r\n\t\t\t\ttext: `${elem.manufacture} ${elem.model} ${elem.modelYear}`,\r\n\t\t\t\tid: elem.VINCode,\r\n\t\t\t\tstatus: elem.status\r\n\t\t\t});\r\n\t\t});\r\n\t\tthis.layoutUtilsService.fetchElements(messages);\r\n\t}\r\n\r\n\t/**\r\n\t * Update status dialog\r\n\t */\r\n\tupdateStatusForProducts() {\r\n\t\tconst _title = 'Update status for selected products';\r\n\t\tconst _updateMessage = 'Status has been updated for selected products';\r\n\t\tconst _statuses = [{ value: 0, text: 'Selling' }, { value: 1, text: 'Sold' }];\r\n\t\tconst _messages = [];\r\n\r\n\t\tthis.selection.selected.forEach(elem => {\r\n\t\t\t_messages.push({\r\n\t\t\t\ttext: `${elem.manufacture} ${elem.model} ${elem.modelYear}`,\r\n\t\t\t\tid: elem.VINCode,\r\n\t\t\t\tstatus: elem.status,\r\n\t\t\t\tstatusTitle: this.getItemStatusString(elem.status),\r\n\t\t\t\tstatusCssClass: this.getItemCssClassByStatus(elem.status)\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tconst dialogRef = this.layoutUtilsService.updateStatusForEntities(_title, _statuses, _messages);\r\n\t\tdialogRef.afterClosed().subscribe(res => {\r\n\t\t\tif (!res) {\r\n\t\t\t\tthis.selection.clear();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.store.dispatch(new ProductsStatusUpdated({\r\n\t\t\t\tstatus: +res,\r\n\t\t\t\tproducts: this.selection.selected\r\n\t\t\t}));\r\n\r\n\t\t\tthis.layoutUtilsService.showActionNotification(_updateMessage, MessageType.Update);\r\n\t\t\tthis.selection.clear();\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Redirect to edit page\r\n\t *\r\n\t * @param id: any\r\n\t */\r\n\teditProduct(id) {\r\n\t\tthis.router.navigate(['../products/edit', id], { relativeTo: this.activatedRoute });\r\n\t}\r\n\r\n\tcreateProduct() {\r\n\t\tthis.router.navigateByUrl('/ecommerce/products/add');\r\n\t}\r\n\r\n\t/**\r\n\t * Check all rows are selected\r\n\t */\r\n\tisAllSelected() {\r\n\t\tconst numSelected = this.selection.selected.length;\r\n\t\tconst numRows = this.productsResult.length;\r\n\t\treturn numSelected === numRows;\r\n\t}\r\n\r\n\t/**\r\n\t * Selects all rows if they are not all selected; otherwise clear selection\r\n\t */\r\n\tmasterToggle() {\r\n\t\tif (this.isAllSelected()) {\r\n\t\t\tthis.selection.clear();\r\n\t\t} else {\r\n\t\t\tthis.productsResult.forEach(row => this.selection.select(row));\r\n\t\t}\r\n\t}\r\n\r\n\t/* UI */\r\n\t/**\r\n\t * Returns status string\r\n\t *\r\n\t * @param status: number\r\n\t */\r\n\tgetItemStatusString(status: number = 0): string {\r\n\t\tswitch (status) {\r\n\t\t\tcase 0:\r\n\t\t\t\treturn 'Selling';\r\n\t\t\tcase 1:\r\n\t\t\t\treturn 'Sold';\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\t/**\r\n\t * Returns CSS Class by status\r\n\t *\r\n\t * @param status: number\r\n\t */\r\n\tgetItemCssClassByStatus(status: number = 0): string {\r\n\t\tswitch (status) {\r\n\t\t\tcase 0:\r\n\t\t\t\treturn 'success';\r\n\t\t\tcase 1:\r\n\t\t\t\treturn 'metal';\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\t/**\r\n\t * Rerurns condition string\r\n\t *\r\n\t * @param condition: number\r\n\t */\r\n\tgetItemConditionString(condition: number = 0): string {\r\n\t\tswitch (condition) {\r\n\t\t\tcase 0:\r\n\t\t\t\treturn 'New';\r\n\t\t\tcase 1:\r\n\t\t\t\treturn 'Used';\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\t/**\r\n\t * Returns CSS Class by condition\r\n\t *\r\n\t * @param condition: number\r\n\t */\r\n\tgetItemCssClassByCondition(condition: number = 0): string {\r\n\t\tswitch (condition) {\r\n\t\t\tcase 0:\r\n\t\t\t\treturn 'danger';\r\n\t\t\tcase 1:\r\n\t\t\t\treturn 'primary';\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n}\r\n"]}