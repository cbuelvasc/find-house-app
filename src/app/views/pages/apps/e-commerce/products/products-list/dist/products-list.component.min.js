"use strict";var __decorate=this&&this.__decorate||function(t,e,s,r){var o,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,s,r);else for(var n=t.length-1;0<=n;n--)(o=t[n])&&(c=(i<3?o(c):3<i?o(e,s,c):o(e,s))||c);return 3<i&&c&&Object.defineProperty(e,s,c),c};exports.__esModule=!0;var core_1=require("@angular/core"),paginator_1=require("@angular/material/paginator"),collections_1=require("@angular/cdk/collections"),operators_1=require("rxjs/operators"),rxjs_1=require("rxjs"),store_1=require("@ngrx/store"),crud_1=require("../../../../../../core/_base/crud"),e_commerce_1=require("../../../../../../core/e-commerce"),ProductsListComponent=function(){function t(t,e,s,r,o,i){this.dialog=t,this.activatedRoute=e,this.router=s,this.subheaderService=r,this.layoutUtilsService=o,this.store=i,this.displayedColumns=["select","VINCode","manufacture","model","modelYear","color","price","condition","status","actions"],this.filterStatus="",this.filterCondition="",this.selection=new collections_1.SelectionModel(!0,[]),this.productsResult=[],this.subscriptions=[]}return t.prototype.ngOnInit=function(){var e=this,t=this.sort.sortChange.subscribe(function(){return e.paginator.pageIndex=0});this.subscriptions.push(t);var s=rxjs_1.merge(this.sort.sortChange,this.paginator.page).pipe(operators_1.tap(function(){return e.loadProductsList()})).subscribe();this.subscriptions.push(s);var r=rxjs_1.fromEvent(this.searchInput.nativeElement,"keyup").pipe(operators_1.debounceTime(150),operators_1.distinctUntilChanged(),operators_1.tap(function(){e.paginator.pageIndex=0,e.loadProductsList()})).subscribe();this.subscriptions.push(r),this.subheaderService.setTitle("Products"),this.dataSource=new e_commerce_1.ProductsDataSource(this.store);var o=this.dataSource.entitySubject.pipe(operators_1.skip(1),operators_1.distinctUntilChanged()).subscribe(function(t){e.productsResult=t});this.subscriptions.push(o);var i=this.store.pipe(store_1.select(e_commerce_1.selectProductsPageLastQuery)).subscribe(function(t){return e.lastQuery=t});this.subscriptions.push(i);var c=this.activatedRoute.queryParams.subscribe(function(t){t.id&&e.restoreState(e.lastQuery,+t.id),rxjs_1.of(void 0).pipe(operators_1.delay(1e3)).subscribe(function(){e.loadProductsList()})});this.subscriptions.push(c)},t.prototype.ngOnDestroy=function(){this.subscriptions.forEach(function(t){return t.unsubscribe()})},t.prototype.loadProductsList=function(){this.selection.clear();var t=new crud_1.QueryParamsModel(this.filterConfiguration(),this.sort.direction,this.sort.active,this.paginator.pageIndex,this.paginator.pageSize);this.store.dispatch(new e_commerce_1.ProductsPageRequested({page:t})),this.selection.clear()},t.prototype.filterConfiguration=function(){var t={},e=this.searchInput.nativeElement.value;return this.filterStatus&&0<this.filterStatus.length&&(t.status=+this.filterStatus),this.filterCondition&&0<this.filterCondition.length&&(t.condition=+this.filterCondition),t.model=e,t.manufacture=e,t.color=e,t.VINCode=e,t},t.prototype.restoreState=function(t,e){t.filter&&("condition"in t.filter&&(this.filterCondition=t.filter.condition.toString()),"status"in t.filter&&(this.filterStatus=t.filter.status.toString()),t.filter.model&&(this.searchInput.nativeElement.value=t.filter.model))},t.prototype.deleteProduct=function(e){var s=this;this.layoutUtilsService.deleteElement("Product Delete","Are you sure to permanently delete this product?","Product is deleting...").afterClosed().subscribe(function(t){t&&(s.store.dispatch(new e_commerce_1.OneProductDeleted({id:e.id})),s.layoutUtilsService.showActionNotification("Product has been deleted",crud_1.MessageType.Delete))})},t.prototype.deleteProducts=function(){var r=this;this.layoutUtilsService.deleteElement("Products Delete","Are you sure to permanently delete selected products?","Products are deleting...").afterClosed().subscribe(function(t){if(t){for(var e=[],s=0;s<r.selection.selected.length;s++)e.push(r.selection.selected[s].id);r.store.dispatch(new e_commerce_1.ManyProductsDeleted({ids:e})),r.layoutUtilsService.showActionNotification("Selected products have been deleted",crud_1.MessageType.Delete),r.selection.clear()}})},t.prototype.fetchProducts=function(){var e=[];this.selection.selected.forEach(function(t){e.push({text:t.manufacture+" "+t.model+" "+t.modelYear,id:t.VINCode,status:t.status})}),this.layoutUtilsService.fetchElements(e)},t.prototype.updateStatusForProducts=function(){var e=this,s=[];this.selection.selected.forEach(function(t){s.push({text:t.manufacture+" "+t.model+" "+t.modelYear,id:t.VINCode,status:t.status,statusTitle:e.getItemStatusString(t.status),statusCssClass:e.getItemCssClassByStatus(t.status)})}),this.layoutUtilsService.updateStatusForEntities("Update status for selected products",[{value:0,text:"Selling"},{value:1,text:"Sold"}],s).afterClosed().subscribe(function(t){t&&(e.store.dispatch(new e_commerce_1.ProductsStatusUpdated({status:+t,products:e.selection.selected})),e.layoutUtilsService.showActionNotification("Status has been updated for selected products",crud_1.MessageType.Update)),e.selection.clear()})},t.prototype.editProduct=function(t){this.router.navigate(["../products/edit",t],{relativeTo:this.activatedRoute})},t.prototype.createProduct=function(){this.router.navigateByUrl("/ecommerce/products/add")},t.prototype.isAllSelected=function(){return this.selection.selected.length===this.productsResult.length},t.prototype.masterToggle=function(){var e=this;this.isAllSelected()?this.selection.clear():this.productsResult.forEach(function(t){return e.selection.select(t)})},t.prototype.getItemStatusString=function(t){switch(void 0===t&&(t=0),t){case 0:return"Selling";case 1:return"Sold"}return""},t.prototype.getItemCssClassByStatus=function(t){switch(void 0===t&&(t=0),t){case 0:return"success";case 1:return"metal"}return""},t.prototype.getItemConditionString=function(t){switch(void 0===t&&(t=0),t){case 0:return"New";case 1:return"Used"}return""},t.prototype.getItemCssClassByCondition=function(t){switch(void 0===t&&(t=0),t){case 0:return"danger";case 1:return"primary"}return""},__decorate([core_1.ViewChild(paginator_1.MatPaginator,{static:!0})],t.prototype,"paginator"),__decorate([core_1.ViewChild("sort1",{static:!0})],t.prototype,"sort"),__decorate([core_1.ViewChild("searchInput",{static:!0})],t.prototype,"searchInput"),t=__decorate([core_1.Component({selector:"kt-products-list",templateUrl:"./products-list.component.html",changeDetection:core_1.ChangeDetectionStrategy.OnPush})],t)}();exports.ProductsListComponent=ProductsListComponent;
//# sourceMappingURL=products-list.component.min.js.map
