"use strict";var __decorate=this&&this.__decorate||function(e,t,r,i){var s,o=arguments.length,n=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var c=e.length-1;0<=c;c--)(s=e[c])&&(n=(o<3?s(n):3<o?s(t,r,n):s(t,r))||n);return 3<o&&n&&Object.defineProperty(t,r,n),n};exports.__esModule=!0;var core_1=require("@angular/core"),paginator_1=require("@angular/material/paginator"),collections_1=require("@angular/cdk/collections"),operators_1=require("rxjs/operators"),rxjs_1=require("rxjs"),store_1=require("@ngrx/store"),crud_1=require("../../../../../../core/_base/crud"),e_commerce_1=require("../../../../../../core/e-commerce"),PropertiesListComponent=function(){function e(e,t,r,i,s,o){this.dialog=e,this.activatedRoute=t,this.router=r,this.subheaderService=i,this.layoutUtilsService=s,this.store=o,this.displayedColumns=["select","id","title","type","city","color","price","condition","status","actions"],this.filterStatus="",this.filterCondition="",this.selection=new collections_1.SelectionModel(!0,[]),this.propertiesResult=[],this.subscriptions=[]}return e.prototype.ngOnInit=function(){var t=this,e=this.sort.sortChange.subscribe(function(){return t.paginator.pageIndex=0});this.subscriptions.push(e);var r=rxjs_1.merge(this.sort.sortChange,this.paginator.page).pipe(operators_1.tap(function(){return t.loadPropertiesList()})).subscribe();this.subscriptions.push(r);var i=rxjs_1.fromEvent(this.searchInput.nativeElement,"keyup").pipe(operators_1.debounceTime(150),operators_1.distinctUntilChanged(),operators_1.tap(function(){t.paginator.pageIndex=0,t.loadPropertiesList()})).subscribe();this.subscriptions.push(i),this.subheaderService.setTitle("Properties"),this.dataSource=new e_commerce_1.PropertiesDataSource(this.store);var s=this.dataSource.entitySubject.pipe(operators_1.skip(1),operators_1.distinctUntilChanged()).subscribe(function(e){t.propertiesResult=e});this.subscriptions.push(s);var o=this.store.pipe(store_1.select(e_commerce_1.selectProductsPageLastQuery)).subscribe(function(e){return t.lastQuery=e});this.subscriptions.push(o);var n=this.activatedRoute.queryParams.subscribe(function(e){e.id&&t.restoreState(t.lastQuery,+e.id),rxjs_1.of(void 0).pipe(operators_1.delay(1e3)).subscribe(function(){t.loadPropertiesList()})});this.subscriptions.push(n)},e.prototype.ngOnDestroy=function(){this.subscriptions.forEach(function(e){return e.unsubscribe()})},e.prototype.loadPropertiesList=function(){this.selection.clear();var e=new crud_1.QueryParamsModel(this.filterConfiguration(),this.sort.direction,this.sort.active,this.paginator.pageIndex,this.paginator.pageSize);this.store.dispatch(new e_commerce_1.PropertiesPageRequested({page:e})),this.selection.clear()},e.prototype.filterConfiguration=function(){var e={};return e.title=this.searchInput.nativeElement.value,e},e.prototype.restoreState=function(e,t){e.filter&&("condition"in e.filter&&(this.filterCondition=e.filter.condition.toString()),"status"in e.filter&&(this.filterStatus=e.filter.status.toString()),e.filter.model&&(this.searchInput.nativeElement.value=e.filter.model))},e.prototype.deleteProduct=function(t){var r=this;this.layoutUtilsService.deleteElement("Property Delete","Are you sure to permanently delete this property?","Property is deleting...").afterClosed().subscribe(function(e){e&&(r.store.dispatch(new e_commerce_1.OnePropertyDeleted({id:t.id})),r.layoutUtilsService.showActionNotification("Property has been deleted",crud_1.MessageType.Delete))})},e.prototype.deleteProducts=function(){var i=this;this.layoutUtilsService.deleteElement("Properties Delete","Are you sure to permanently delete selected properties?","Properties are deleting...").afterClosed().subscribe(function(e){if(e){for(var t=[],r=0;r<i.selection.selected.length;r++)t.push(i.selection.selected[r].id);i.store.dispatch(new e_commerce_1.ManyPropertiesDeleted({ids:t})),i.layoutUtilsService.showActionNotification("Selected properties have been deleted",crud_1.MessageType.Delete),i.selection.clear()}})},e.prototype.fetchProducts=function(){var t=[];this.selection.selected.forEach(function(e){t.push({text:e.desc+" "+e.neighborhood,id:e.id,status:e.title})}),this.layoutUtilsService.fetchElements(t)},e.prototype.updateStatusForProducts=function(){var t=this;this.layoutUtilsService.updateStatusForEntities("Update status for selected properties",[{value:0,text:"Selling"},{value:1,text:"Sold"}],[]).afterClosed().subscribe(function(e){e&&(t.store.dispatch(new e_commerce_1.PropertiesStatusUpdated({status:+e,properties:t.selection.selected})),t.layoutUtilsService.showActionNotification("Status has been updated for selected properties",crud_1.MessageType.Update)),t.selection.clear()})},e.prototype.editProduct=function(e){this.router.navigate(["../properties/edit",e],{relativeTo:this.activatedRoute})},e.prototype.createProperties=function(){this.router.navigateByUrl("/ecommerce/properties/add")},e.prototype.isAllSelected=function(){return this.selection.selected.length===this.propertiesResult.length},e.prototype.masterToggle=function(){var t=this;this.isAllSelected()?this.selection.clear():this.propertiesResult.forEach(function(e){return t.selection.select(e)})},e.prototype.getItemStatusString=function(e){switch(void 0===e&&(e=0),e){case 0:return"Selling";case 1:return"Sold"}return""},e.prototype.getItemCssClassByStatus=function(e){switch(void 0===e&&(e=0),e){case 0:return"success";case 1:return"metal"}return""},e.prototype.getItemConditionString=function(e){switch(void 0===e&&(e=0),e){case 0:return"New";case 1:return"Used"}return""},e.prototype.getItemCssClassByCondition=function(e){switch(void 0===e&&(e=0),e){case 0:return"danger";case 1:return"primary"}return""},__decorate([core_1.ViewChild(paginator_1.MatPaginator,{static:!0})],e.prototype,"paginator"),__decorate([core_1.ViewChild("sort1",{static:!0})],e.prototype,"sort"),__decorate([core_1.ViewChild("searchInput",{static:!0})],e.prototype,"searchInput"),e=__decorate([core_1.Component({selector:"app-properties-list",templateUrl:"./properties-list.component.html",changeDetection:core_1.ChangeDetectionStrategy.OnPush})],e)}();exports.PropertiesListComponent=PropertiesListComponent;
//# sourceMappingURL=properties-list.component.min.js.map
