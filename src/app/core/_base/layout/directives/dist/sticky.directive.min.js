"use strict";var __decorate=this&&this.__decorate||function(t,e,r,o){var i,n=arguments.length,s=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,o);else for(var a=t.length-1;0<=a;a--)(i=t[a])&&(s=(n<3?i(s):3<n?i(e,r,s):i(e,r))||s);return 3<n&&s&&Object.defineProperty(e,r,s),s},__param=this&&this.__param||function(r,o){return function(t,e){o(t,e,r)}};exports.__esModule=!0;var core_1=require("@angular/core"),common_1=require("@angular/common"),rxjs_1=require("rxjs"),animationFrame_1=require("rxjs/internal/scheduler/animationFrame"),operators_1=require("rxjs/operators"),StickyDirective=function(){function t(t,e){var n=this;this.stickyElement=t,this.platformId=e,this.filterGate=!1,this.marginTop$=new rxjs_1.BehaviorSubject(0),this.marginBottom$=new rxjs_1.BehaviorSubject(0),this.enable$=new rxjs_1.BehaviorSubject(!0),this.sticky=!1,this.boundaryReached=!1,this.scroll$=new rxjs_1.Subject,this.resize$=new rxjs_1.Subject,this.extraordinaryChange$=new rxjs_1.BehaviorSubject(void 0),this.componentDestroyed=new rxjs_1.Subject,this.listener=function(t){var e=t.target.scrollTop||window.pageYOffset;n.scroll$.next(e)},this.scrollThrottled$=this.scroll$.pipe(operators_1.throttleTime(0,animationFrame_1.animationFrame),operators_1.share()),this.resizeThrottled$=this.resize$.pipe(operators_1.throttleTime(0,animationFrame_1.animationFrame),operators_1.startWith(null),operators_1.share()),this.status$=rxjs_1.combineLatest(this.enable$,this.scrollThrottled$,this.marginTop$,this.marginBottom$,this.extraordinaryChange$,this.resizeThrottled$).pipe(operators_1.filter(function(t){var e=t[0];return n.checkEnabled(e)}),operators_1.map(function(t){var e=t[0],r=t[1],o=t[2],i=t[3];return n.determineStatus(n.determineElementOffsets(),r,o,i,e)}),operators_1.share())}return Object.defineProperty(t.prototype,"marginTop",{set:function(t){this.marginTop$.next(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"marginBottom",{set:function(t){this.marginBottom$.next(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enable",{set:function(t){this.enable$.next(t)},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){var e=this;this.status$.pipe(operators_1.takeUntil(this.componentDestroyed)).subscribe(function(t){return e.setSticky(t)})},t.prototype.recalculate=function(){var t=this;common_1.isPlatformBrowser(this.platformId)&&setTimeout(function(){t.extraordinaryChange$.next(void 0)},0)},t.prototype.checkEnabled=function(t){return!!common_1.isPlatformBrowser(this.platformId)&&(t?!(this.filterGate=!1):!this.filterGate&&(this.filterGate=!0))},t.prototype.onWindowResize=function(){common_1.isPlatformBrowser(this.platformId)&&this.resize$.next()},t.prototype.setupListener=function(){common_1.isPlatformBrowser(this.platformId)&&this.getScrollTarget().addEventListener("scroll",this.listener)},t.prototype.removeListener=function(){common_1.isPlatformBrowser(this.platformId)&&this.getScrollTarget().removeEventListener("scroll",this.listener)},t.prototype.ngOnInit=function(){this.setupListener()},t.prototype.ngOnDestroy=function(){this.componentDestroyed.next(),this.removeListener()},t.prototype.getComputedStyle=function(t){return t.getBoundingClientRect()},t.prototype.getScrollTarget=function(){return this.scrollContainer&&"string"==typeof this.scrollContainer?document.querySelector(this.scrollContainer):this.scrollContainer&&this.scrollContainer instanceof HTMLElement?this.scrollContainer:window},t.prototype.determineStatus=function(t,e,r,o,i){var n=this.getComputedStyle(this.stickyElement.nativeElement).height,s=this.boundaryElement&&window.pageYOffset+n+o>=t.bottomBoundary-r;return{isSticky:i&&e>t.offsetY,reachedLowerEdge:s,marginBottom:o,marginTop:r}},t.prototype.determineElementOffsets=function(){this.sticky&&this.removeSticky();var t=null;this.boundaryElement&&(t=this.getComputedStyle(this.boundaryElement).height+getPosition(this.boundaryElement).y);return{offsetY:getPosition(this.stickyElement.nativeElement).y-this.marginTop$.value,bottomBoundary:t}},t.prototype.makeSticky=function(t,e,r){void 0===t&&(t=!1),this.boundaryReached=t;var o=this.getComputedStyle(this.stickyElement.nativeElement),i=o.width,n=o.height;o.left,t?(this.getComputedStyle(this.boundaryElement).bottom,this.marginBottom$.value):this.marginTop$.value;if(this.sticky=!0,this.stickyElement.nativeElement.style.position="sticky",this.stickyElement.nativeElement.style.backgroundColor="#fff",this.stickyElement.nativeElement.style.top=this.marginTop$.value+"px",this.stickyElement.nativeElement.style.width=i+"px",this.stickyElement.nativeElement.style.zIndex="2",this.spacerElement){var s=r+n+e;this.spacerElement.style.height=s+"px"}},t.prototype.checkSetup=function(){core_1.isDevMode()&&!this.spacerElement&&console.warn('******There might be an issue with your sticky directive!******\n\nYou haven\'t specified a spacer element. This will cause the page to jump.\n\nBest practise is to provide a spacer element (e.g. a div) right before/after the sticky element.\nThen pass the spacer element as input:\n\n<div #spacer></div>\n\n<div stickyThing="" [spacer]="spacer">\n    I am sticky!\n</div>')},t.prototype.setSticky=function(t){t.isSticky?this.makeSticky(t.reachedLowerEdge,t.marginTop,t.marginBottom):this.removeSticky()},t.prototype.removeSticky=function(){this.boundaryReached=!1,this.sticky=!1,this.stickyElement.nativeElement.style.position="",this.stickyElement.nativeElement.style.width="auto",this.stickyElement.nativeElement.style.left="auto",this.stickyElement.nativeElement.style.top="auto",this.spacerElement&&(this.spacerElement.style.height="0")},__decorate([core_1.Input()],t.prototype,"scrollContainer"),__decorate([core_1.Input("spacerElement")],t.prototype,"spacerElement"),__decorate([core_1.Input("boundaryElement")],t.prototype,"boundaryElement"),__decorate([core_1.HostBinding("class.is-sticky")],t.prototype,"sticky"),__decorate([core_1.HostBinding("class.boundary-reached")],t.prototype,"boundaryReached"),__decorate([core_1.Input()],t.prototype,"marginTop"),__decorate([core_1.Input()],t.prototype,"marginBottom"),__decorate([core_1.Input()],t.prototype,"enable"),__decorate([core_1.HostListener("window:resize",[])],t.prototype,"onWindowResize"),t=__decorate([core_1.Directive({selector:"[appSticky]"}),__param(1,core_1.Inject(core_1.PLATFORM_ID))],t)}();function getPosition(t){for(var e=0,r=0,o=t;e+=o.offsetTop||0,r+=o.offsetLeft||0,o=o.offsetParent;);return{y:e,x:r}}exports.StickyDirective=StickyDirective;
//# sourceMappingURL=sticky.directive.min.js.map
