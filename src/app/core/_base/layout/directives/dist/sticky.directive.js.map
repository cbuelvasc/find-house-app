{"version":3,"sources":["sticky.directive.ts"],"names":[],"mappings":"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","file":"sticky.directive.js","sourcesContent":["import {\r\n  AfterViewInit,\r\n  Directive,\r\n  ElementRef,\r\n  HostBinding,\r\n  HostListener,\r\n  Inject,\r\n  Input,\r\n  isDevMode,\r\n  OnDestroy,\r\n  OnInit,\r\n  PLATFORM_ID\r\n} from '@angular/core';\r\nimport { isPlatformBrowser } from '@angular/common';\r\nimport { BehaviorSubject, combineLatest, Observable, Subject } from 'rxjs';\r\nimport { animationFrame } from 'rxjs/internal/scheduler/animationFrame';\r\nimport { filter, map, share, startWith, takeUntil, throttleTime } from 'rxjs/operators';\r\n\r\nexport interface StickyPositions {\r\n  offsetY: number;\r\n  bottomBoundary: number | null;\r\n}\r\n\r\nexport interface StickyStatus {\r\n  isSticky: boolean;\r\n  reachedLowerEdge: boolean;\r\n  marginTop: number;\r\n  marginBottom: number;\r\n}\r\n\r\n@Directive({\r\n  selector: '[appSticky]'\r\n})\r\nexport class StickyDirective implements OnInit, AfterViewInit, OnDestroy {\r\n\r\n  filterGate = false;\r\n  marginTop$ = new BehaviorSubject(0);\r\n  marginBottom$ = new BehaviorSubject(0);\r\n  enable$ = new BehaviorSubject(true);\r\n\r\n  @Input() scrollContainer: string | HTMLElement;\r\n  // tslint:disable-next-line\r\n  @Input('spacerElement') spacerElement: HTMLElement | undefined;\r\n  // tslint:disable-next-line\r\n  @Input('boundaryElement') boundaryElement: HTMLElement | undefined;\r\n  @HostBinding('class.is-sticky') sticky = false;\r\n  @HostBinding('class.boundary-reached') boundaryReached = false;\r\n\r\n\r\n  private scroll$ = new Subject<number>();\r\n  private scrollThrottled$: Observable<number>;\r\n  private resize$ = new Subject<void>();\r\n  private resizeThrottled$: Observable<void>;\r\n  private extraordinaryChange$ = new BehaviorSubject<void>(undefined);\r\n  private status$: Observable<StickyStatus>;\r\n  private componentDestroyed = new Subject<void>();\r\n\r\n  constructor(private stickyElement: ElementRef, @Inject(PLATFORM_ID) private platformId: string) {\r\n\r\n    /** Throttle the scroll to animation frame (around 16.67ms) */\r\n    this.scrollThrottled$ = this.scroll$\r\n      .pipe(\r\n        throttleTime(0, animationFrame),\r\n        share()\r\n      );\r\n\r\n    /** Throttle the resize to animation frame (around 16.67ms) */\r\n    this.resizeThrottled$ = this.resize$\r\n      .pipe(\r\n        throttleTime(0, animationFrame),\r\n        // emit once since we are currently using combineLatest\r\n        startWith(null),\r\n        share()\r\n      );\r\n\r\n    this.status$ = combineLatest(\r\n      this.enable$,\r\n      this.scrollThrottled$,\r\n      this.marginTop$,\r\n      this.marginBottom$,\r\n      this.extraordinaryChange$,\r\n      this.resizeThrottled$,\r\n    )\r\n      .pipe(\r\n        filter(([enabled]) => this.checkEnabled(enabled)),\r\n        map(([enabled, pageYOffset, marginTop, marginBottom]) =>\r\n          this.determineStatus(this.determineElementOffsets(), pageYOffset, marginTop, marginBottom, enabled)),\r\n        share(),\r\n      );\r\n  }\r\n\r\n  @Input() set marginTop(value: number) {\r\n    this.marginTop$.next(value);\r\n  }\r\n\r\n  @Input() set marginBottom(value: number) {\r\n    this.marginBottom$.next(value);\r\n  }\r\n\r\n  @Input() set enable(value: boolean) {\r\n    this.enable$.next(value);\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.status$\r\n      .pipe(takeUntil(this.componentDestroyed))\r\n      .subscribe((status) => this.setSticky(status));\r\n  }\r\n\r\n  public recalculate(): void {\r\n    if (isPlatformBrowser(this.platformId)) {\r\n      // Make sure to be in the next tick by using timeout\r\n      setTimeout(() => {\r\n        this.extraordinaryChange$.next(undefined);\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * This is nasty code that should be refactored at some point.\r\n   *\r\n   * The Problem is, we filter for enabled. So that the code doesn't run\r\n   * if @Input enabled = false. But if the user disables, we need exactly 1\r\n   * emit in order to reset and call removeSticky. So this method basically\r\n   * turns the filter in \"filter, but let the first pass\".\r\n   */\r\n  checkEnabled(enabled: boolean): boolean {\r\n\r\n    if (!isPlatformBrowser(this.platformId)) {\r\n      return false;\r\n    }\r\n\r\n    if (enabled) {\r\n      // reset the gate\r\n      this.filterGate = false;\r\n      return true;\r\n    } else {\r\n      if (this.filterGate) {\r\n        // gate closed, first emit has happened\r\n        return false;\r\n      } else {\r\n        // this is the first emit for enabled = false,\r\n        // let it pass, and activate the gate\r\n        // so the next wont pass.\r\n        this.filterGate = true;\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  @HostListener('window:resize', [])\r\n  onWindowResize(): void {\r\n    if (isPlatformBrowser(this.platformId)) {\r\n      this.resize$.next();\r\n    }\r\n  }\r\n\r\n  setupListener(): void {\r\n    if (isPlatformBrowser(this.platformId)) {\r\n      const target = this.getScrollTarget();\r\n      target.addEventListener('scroll', this.listener);\r\n    }\r\n  }\r\n\r\n  removeListener() {\r\n    if (isPlatformBrowser(this.platformId)) {\r\n      const target = this.getScrollTarget();\r\n      target.removeEventListener('scroll', this.listener);\r\n    }\r\n  }\r\n\r\n  listener = (e: Event) => {\r\n    const upperScreenEdgeAt = (e.target as HTMLElement).scrollTop || window.pageYOffset;\r\n    this.scroll$.next(upperScreenEdgeAt);\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    // this.checkSetup();\r\n    this.setupListener();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.componentDestroyed.next();\r\n    this.removeListener();\r\n  }\r\n\r\n  getComputedStyle(el: HTMLElement): ClientRect | DOMRect {\r\n    return el.getBoundingClientRect();\r\n  }\r\n\r\n  private getScrollTarget(): Element | Window {\r\n\r\n    let target: Element | Window;\r\n\r\n    if (this.scrollContainer && typeof this.scrollContainer === 'string') {\r\n      target = document.querySelector(this.scrollContainer);\r\n    } else if (this.scrollContainer && this.scrollContainer instanceof HTMLElement) {\r\n      target = this.scrollContainer;\r\n    } else {\r\n      target = window;\r\n    }\r\n    return target;\r\n  }\r\n\r\n  private determineStatus(originalVals: StickyPositions,\r\n    pageYOffset: number,\r\n    marginTop: number,\r\n    marginBottom: number,\r\n    enabled: boolean): StickyStatus {\r\n    const stickyElementHeight = this.getComputedStyle(this.stickyElement.nativeElement).height;\r\n    const reachedLowerEdge = this.boundaryElement &&\r\n      window.pageYOffset + stickyElementHeight + marginBottom >= (originalVals.bottomBoundary - marginTop);\r\n    return {\r\n      isSticky: enabled && pageYOffset > originalVals.offsetY,\r\n      reachedLowerEdge,\r\n      marginBottom,\r\n      marginTop,\r\n    };\r\n  }\r\n\r\n\r\n  /**\r\n   * Gets the offset for element. If the element\r\n   * currently is sticky, it will get removed\r\n   * to access the original position. Other\r\n   * wise this would just be 0 for fixed elements.\r\n   */\r\n  private determineElementOffsets(): StickyPositions {\r\n    if (this.sticky) {\r\n      this.removeSticky();\r\n    }\r\n\r\n    let bottomBoundary: number | null = null;\r\n\r\n    if (this.boundaryElement) {\r\n      const boundaryElementHeight = this.getComputedStyle(this.boundaryElement).height;\r\n      const boundaryElementOffset = getPosition(this.boundaryElement).y;\r\n      bottomBoundary = boundaryElementHeight + boundaryElementOffset;\r\n    }\r\n\r\n    return { offsetY: (getPosition(this.stickyElement.nativeElement).y - this.marginTop$.value), bottomBoundary };\r\n  }\r\n\r\n  private makeSticky(boundaryReached: boolean = false, marginTop: number, marginBottom: number): void {\r\n\r\n    this.boundaryReached = boundaryReached;\r\n\r\n    // do this before setting it to pos:fixed\r\n    const { width, height, left } = this.getComputedStyle(this.stickyElement.nativeElement);\r\n    const offSet = boundaryReached ?\r\n      (this.getComputedStyle(this.boundaryElement).bottom - height - this.marginBottom$.value) : this.marginTop$.value;\r\n\r\n    this.sticky = true;\r\n    this.stickyElement.nativeElement.style.position = 'sticky';\r\n    this.stickyElement.nativeElement.style.backgroundColor = '#fff';\r\n    this.stickyElement.nativeElement.style.top = this.marginTop$.value + 'px';\r\n    // this.stickyElement.nativeElement.style.left = left + 'px';\r\n    this.stickyElement.nativeElement.style.width = `${width}px`;\r\n    this.stickyElement.nativeElement.style.zIndex = `2`;\r\n    if (this.spacerElement) {\r\n      const spacerHeight = marginBottom + height + marginTop;\r\n      this.spacerElement.style.height = `${spacerHeight}px`;\r\n    }\r\n  }\r\n\r\n  private checkSetup() {\r\n    if (isDevMode() && !this.spacerElement) {\r\n      console.warn(`******There might be an issue with your sticky directive!******\r\n\r\nYou haven't specified a spacer element. This will cause the page to jump.\r\n\r\nBest practise is to provide a spacer element (e.g. a div) right before/after the sticky element.\r\nThen pass the spacer element as input:\r\n\r\n<div #spacer></div>\r\n\r\n<div stickyThing=\"\" [spacer]=\"spacer\">\r\n    I am sticky!\r\n</div>`);\r\n    }\r\n  }\r\n\r\n\r\n  private setSticky(status: StickyStatus): void {\r\n    if (status.isSticky) {\r\n      this.makeSticky(status.reachedLowerEdge, status.marginTop, status.marginBottom);\r\n    } else {\r\n      this.removeSticky();\r\n    }\r\n  }\r\n\r\n  private removeSticky(): void {\r\n\r\n    this.boundaryReached = false;\r\n    this.sticky = false;\r\n\r\n    this.stickyElement.nativeElement.style.position = '';\r\n    this.stickyElement.nativeElement.style.width = 'auto';\r\n    this.stickyElement.nativeElement.style.left = 'auto';\r\n    this.stickyElement.nativeElement.style.top = 'auto';\r\n    if (this.spacerElement) {\r\n      this.spacerElement.style.height = '0';\r\n    }\r\n  }\r\n}\r\n\r\n// Thanks to https://stanko.github.io/javascript-get-element-offset/\r\nfunction getPosition(el) {\r\n  let top = 0;\r\n  let left = 0;\r\n  let element = el;\r\n\r\n  // Loop through the DOM tree\r\n  // and add it's parent's offset to get page offset\r\n  do {\r\n    top += element.offsetTop || 0;\r\n    left += element.offsetLeft || 0;\r\n    element = element.offsetParent;\r\n  } while (element);\r\n\r\n  return {\r\n    y: top,\r\n    x: left,\r\n  };\r\n}\r\n"]}